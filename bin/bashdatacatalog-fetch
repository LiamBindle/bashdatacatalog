#!/usr/bin/env bash
set -u
if [ ! -z ${DEBUG+x} ]; then
    set -x
fi

function download_file() {
    URL=$1
    FILE_PATH=$2
    curl -f --silent -k -n -L -g --url $URL -o $FILE_PATH --create-dirs
}

function download_metadata() {
    echo "Fetching metadata from '${BDC_COLLECTION_URL}'"
    download_file ${BDC_COLLECTION_URL}/.assets.md5 .assets.md5 
    if [ ! -f .assets.md5 ]; then
        echo "Failed to download '.assets.md5' from ${BDC_COLLECTION_URL}"
        exit 1 
    fi
    download_file ${BDC_COLLECTION_URL}/.temporal_assets.sed .temporal_assets.sed
    download_file ${BDC_COLLECTION_URL}/.ignore.grep .ignore.grep
}


source bashdatacatalog-execdir 'download_metadata' $@
